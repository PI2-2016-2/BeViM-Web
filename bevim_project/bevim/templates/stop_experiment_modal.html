{% extends "base.html" %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load i18n %}
{% load bootstrap_ui_tags %}

{% block content %}
<div id="processing_experiment" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="text-center modal-title">{% trans 'Processing data' %}</h3>
      </div>
      <div class="modal-body text-center">
          <br>
            <h1><i class="fa fa-cog fa-spin fa-3x fa-fw"></i></h1>
          </p>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>

<div id="get_data_url" style="display: none;">
    {% url 'process_result' experiment_id=experiment_id %}
</div>

<div id="total_time" style="display: none;">
    {{total_time}}
</div>
{% endblock %}


{% block body-javascript %}
    {{ block.super }}

  <script type="text/javascript">
      $(document).ready(function(){
        $("#processing_experiment").modal('show');
        get_result();
      });

      function get_result(){
        var url_post = $("#get_data_url").html();
        $.ajax({
          type:"POST",
          url: url_post,
          data: {},
            beforeSend: function(xhr, settings) {
            var token = $('input[name="csrfmiddlewaretoken"]').prop('value');
                xhr.setRequestHeader("X-CSRFToken", token);
              },
            success: function(response){
              var url = response.toString();
              if(url.includes("processing_data")){
                var time = $("#total_time").html();
                setTimeout(get_result, (time*1000));
              }
              else{
                $("#processing_experiment").modal('hide');
                  window.location.href = response;
              }
            }
        });
      }


  </script>

{% endblock %}
